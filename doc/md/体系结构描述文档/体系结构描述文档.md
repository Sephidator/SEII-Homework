体系结构描述文档——<br/>灯具进销存管理系统<br/><br/>软工二小组
=========================



<br/>
<br/>
<br/>

# 更新历史
| **修改人员**           | **日期**     | **变更原因** | **版本** |
| ------------------ | ---------- | -------- | ------ |
| 陈骁、陈思彤、<br/>王宁、王颀涵 | 2017-10-10 | 最初版本     | V1.0   |

<br/>
<br/>
***********************************************
<br/>
<br/>

# 变更记录
| **修改人员**           | **日期**     | **变更原因** | **版本** | **变更内容** |
| ------------------ | ---------- | -------- | ------ | -------- |
| 陈骁、陈思彤、<br/>王宁、王颀涵 | 2017-10-10 | 初始版本     | V1.0   | 无        |

<br/>
<br/>
***********************************************
<br/>
<br/>

# 目录
	1.引言
		1.1 编制目的
		1.2 参考资料
	2.产品概述
	3.逻辑视角
	4.组合视角
		4.1 开发包图
		4.2 运行时进程
		4.3 物理部署
	5.接口视角
		5.1 模块的职责
		5.2 用户界面层的分解
		5.3 业务逻辑层的分解
		5.4 数据层的分解
	6.信息视角
		6.1 数据持久化对象
		6.2 Txt持久化格式
		6.3 数据库表

<br/>
<br/>
***********************************************
<br/>
<br/>

# 1.引言

## 1.1 编制目的
本报告详细完成对灯具照明行业进销存系统的概要设计，达到指导详细设计和开发的目
的，同时实现测试人员及用户的沟通。<br/>
本报告面向开发人员、测试人员及最终用户编写，是了解系统的导航。

<br/>
<br/>
***********************************************
<br/>
<br/>

## 1.2 参考资料
附录D.3 连锁商店（MSCS）软件体系描述结构文档

<br/>
<br/>
***********************************************
<br/>
<br/>

# 2.产品概述
参考灯具照明行业进销存系统用例文档和灯具照明行业进销存系统软件规格说明中对产
品的概括描述。

<br/>
<br/>
***********************************************
<br/>
<br/>

# 3.逻辑视角
灯具进销存管理系统中，选择了分层体系结构的风格，将系统分为3层（展示层、业务逻辑层、数据层）能够很好的示意整个高层抽象。展示层包括GUI页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案如图1和图2所示。

![](/pics/体系结构逻辑视角.png)
![](/pics/体系结构逻辑设计方案.png)

<br/>
<br/>
***********************************************
<br/>
<br/>

# 4.组合视角
## 4.1 开发包图
灯具进销存管理系统的最终开发包设计如下表所示

| 开发（物理）包              | 依赖的其他开发包                                 |
| -------------------- | ---------------------------------------- |
| mainui               | goodssortui, goodsui, inventoryui, clientui, purchaseui, saleui, reportui, accountui, billui, initialui, approvalui, promotionui, userui, logui, vo |
|                      |                                          |
| goodssortui          | goodssortblservice, 界面类库包, vo            |
| goodssortblservice   |                                          |
| goodssortbl          | goodssortblservice, goodssortdataservice, po, goodsbl |
| goodssortdataservice | Java RMI, po                             |
| goodssortdata        | databaseutility, po, goodssortdataservice |
|                      |                                          |
| goodsui              | goodsblservice, 界面类库包, vo                |
| goodsblservice       |                                          |
| goodsbl              | goodsblservice, goodsdataservice, po     |
| goodsdataservice     | Java RMI, po                             |
| goodsdata            | databaseutility, po, goodsdataservice    |
|                      |                                          |
| inventoryui          | inventoryblservice, 界面类库包, vo            |
| inventoryblservice   |                                          |
| inventorybl          | inventoryblservice, inventorydataservice, po, goodsbl,userbl |
| inventorydataservice | Java RMI, po                             |
| inventorydata        | databaseutility, po, inventorydataservice |
|                      |                                          |
| clientui             | clientblservice, 界面类库包, vo               |
| clientblservice      |                                          |
| clientbl             | clientblservice, clientdataservice, po   |
| clientdataservice    | Java RMI, po                             |
| clientdata           | databaseutility, po, clientdataservice   |
|                      |                                          |
| purchaseui           | purchaseblservice, 界面类库包, vo             |
| purchaseblservice    |                                          |
| purchasebl           | purchaseblservice, purchasedataservice, po, goodsbl, clientbl, accountbl, inventorybl, userbl |
| purchasedataservice  | Java RMI, po                             |
| purchasedata         | databaseutility, po, purchasedataservice |
|                      |                                          |
| saleui               | saleblservice, 界面类库包, vo                 |
| saleblservice        |                                          |
| salebl               | saleblservice, saledataservice, po, goodsbl, clientbl, accountbl, inventorybl, userbl |
| saledataservice      | Java RMI, po                             |
| saledata             | databaseutility, po, saledataservice     |
|                      |                                          |
| reportui             | reportblservice, 界面类库包, vo               |
| reportblservice      |                                          |
| reportbl             | reportblservice, reportdataservice, po, inventorybl, purchasebl, saleui, billbl |
| reportdataservice    | Java RMI, po                             |
| reportdata           | databaseutility, po, reportdataservice   |
|                      |                                          |
| accountui            | accountblservice, 界面类库包, vo              |
| accountblservice     |                                          |
| accountbl            | accountblservice, accountdataservice, po |
| accountdataservice   | Java RMI, po                             |
| accountdata          | databaseutility, po, accountdataservice  |
|                      |                                          |
| billui               | billblservice, 界面类库包, vo                 |
| billblservice        |                                          |
| billbl               | billblservice, billdataservice, po, accountbl, userbl |
| billdataservice      | Java RMI, po                             |
| billdata             | databaseutility, po, billdataservice     |
|                      |                                          |
| initialui            | initialblservice, 界面类库包, vo              |
| initialblservice     |                                          |
| initialbl            | initialblservice, initialdataservice, po, goodsbl, client, accountbl |
| initialdataservice   | Java RMI, po                             |
| initialdata          | databaseutility, po, initialdataservice  |
|                      |                                          |
| approvalui           | approvalblservice, 界面类库包, vo             |
| approvalblservice    |                                          |
| approvalbl           | approvalblservice, approvaldataservice, po, inventorybl, purchasebl, saleui, billbl |
| approvaldataservice  | Java RMI, po                             |
| approvaldata         | databaseutility, po, approvaldataservice |
|                      |                                          |
| promotionui          | promotionblservice, 界面类库包, vo            |
| promotionblservice   |                                          |
| promotionbl          | promotionblservice, promotiondataservice, po, goodsbl, salebl, clientbl, accountbl |
| promotiondataservice | Java RMI, po                             |
| promotiondata        | databaseutility, po, promotiondataservice |
|                      |                                          |
| userui               | userblservice, 界面类库包, vo                 |
| userblservice        |                                          |
| userbl               | userblservice, userdataservice, po       |
| userdataservice      | Java RMI, po                             |
| userdata             | databaseutility, po, userdataservice     |
|                      |                                          |
| logui                | logblservice, 界面类库包, vo                  |
| logblservice         |                                          |
| logbl                | logblservice, logdataservice, po, inventorybl, purchasebl, saleui, billbl, userbl |
| logdataservice       | Java RMI, po                             |
| logdata              | databaseutility, po, logdataservice      |
<br/>

灯具进销存管理系统客户端开发包图和服务器端开发包图如图3和图4所示。

![](/pics/客户端开发包图.png)
![](/pics/服务器端开发包图.png)

<br/>
<br/>
***********************************************
<br/>
<br/>

## 4.2 运行时进程
在灯具进销存管理系统中，会有多个客户端进程和一个服务器端进程，其进程如图5所示。结合部署图，客户端进程是在客户端机器上运行，服务器端进程是在服务器端机器上运行。

![](/pics/进程图.png)

<br/>
<br/>
***********************************************
<br/>
<br/>

## 4.3 物理部署
灯具进销存管理系统中客户端构件是放在客户端机上，服务器端构件是放在服务器端机器上。在客户端节点上，还要部署RMIStub构件。由于Java RMI 构件属于JDK 1.8的一部分。所以，在系统JDK环境已经设置好的情况下，不需要独立部署。部署图如图6所示。

![](/pics/部署图.png)

<br/>
<br/>
***********************************************
<br/>
<br/>

# 5.接口视角
## 5.1 模块的职责
客户端模块和服务器模块视图分别如图7和图8所示。客户端各层和服务器端各层的职责分别如下表所示。

![](/pics/客户端与服务器端模块视图.png)

| 客户端各层   | 客户端各层的职责               |
| ------- | ---------------------- |
| 启动模块    | 负责初始化网络通信机制，启动用户界面     |
| 用户界面层   | 基于窗口的进销存管理系统客户端用户界面    |
| 业务逻辑层   | 对于用户界面的输入进行响应并进行业务处理逻辑 |
| 客户端网络模块 | 利用java RMI机制查找RMI服务    |
<br/>

| 服务器端各层   | 服务器端各层的职责                   |
| -------- | --------------------------- |
| 启动模块     | 负责初始化网络通信机制，启动用户界面          |
| 数据层      | 负责数据的持久化及数据访问接口             |
| 服务器端网络模块 | 利用Java RMI机制开启RMI服务，注册RMI服务 |
<br/>

每一层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层与层之间调用的接口下表所示。

| 接口                                       | 服务调用方    | 服务提供方    |
| ---------------------------------------- | -------- | -------- |
| goodssortblservice<br/>goodsblservice<br/>inventoryblservice<br/>clientblservice<br/>purchaseblservice<br/>saleblservice<br/>reportblservice<br/>accountblservice<br/>billblservice<br/>initialblservice<br/>approvalblservice<br/>promotionblservice<br/>userblservice<br/>logblservice | 客户端展示层   | 客户端业务逻辑层 |
| goodssortdataservice<br/>goodsdataservice<br/>inventorydataservice<br/>clientdataservice<br/>purchasedataservice<br/>saledataservice<br/>reportdataservice<br/>accountdataservice<br/>billdataservice<br/>initialdataservice<br/>approvaldataservice<br/>promotiondataservice<br/>userdataservice<br/>logdataservice | 客户端业务逻辑层 | 服务器端数据层  |
<br/>

借用销售用例来说明层之间的调用，如图9所示。每一层之间都是由上一层依赖了一个接口(需接口)，而下层实现这个接口(供接口)。saleblservice提供了sale界面所需要的所有业务逻辑功能。saledataservice提供了对数据库的增、删、改、查等操作。这样的实现就大大降低了层与层之间的耦合。

<br/>
<br/>
***********************************************
<br/>
<br/>

## 5.2 用户界面层的分解

<br/>
<br/>
***********************************************
<br/>
<br/>

## 5.3 业务逻辑层的分解
业务逻辑层包括多个针对界面的业务逻辑处理对象。其设计图如图12所示。

![](/pics/业务逻辑层的设计.png)

### 5.3.1 业务逻辑层模块的职责
业务逻辑层模块的职责如下表所示

| 表8          | 业务逻辑层模块的职责              |
| ----------- | ----------------------- |
| 模块          | 职责                      |
| goodssortbl | 负责实现商品分类与商品分类管理界面所需要的服务 |
| goodsbl     | 负责实现商品与商品管理界面所需要的服务     |
| inventorybl | 负责实现仓库管理界面所需要的服务        |
| clientbl    | 负责实现客户管理界面所需要的服务        |
| purchasebl  | 负责实现进货界面所需要的服务          |
| salebl      | 负责实现销售界面所需要的服务          |
| reportbl    | 负责实现查看报表界面所需要的服务        |
| accountbl   | 负责实现账户管理界面所需要的服务        |
| billbl      | 负责实现财务单据界面所需要的服务        |
| initialbl   | 负责实现期初建账界面所需要的服务        |
| approvalbl  | 负责实现审批界面所需要的服务          |
| promotionbl | 负责实现销售策略界面所需要的服务        |
| userbl      | 负责实现登陆及用户管理界面所需要的服务     |
| logbl       | 负责实现查看日志界面所需要的服务        |
| editbillbl       | 负责实现修改单据界面所需要的服务        |
<br/>

### 5.3.2 业务逻辑层模块的接口规范

| clietbl模块提供的服务（供接口）            |      |                                          |
| ------------------------------ | ---- | ---------------------------------------- |
| `ClientBlService.findCl、ient`  | 语法   | `public ArraytList<Client> findClient(String ID, String name)` |
|                                | 前置条件 | id和姓名符合输入条件                              |
|                                | 后置条件 | 查找到目标客户                                  |
| `ClientBlService.addClient`    | 语法   | `public ResultMessage addClient(String ID, String category, int level, String name, String phone, String address, String post, String email, UserVO salesman)` |
|                                | 前置条件 | 客户信息输入正确且不和其他客户重复                        |
|                                | 后置条件 | 添加客户，更新持久化对象                             |
| `ClientBlService.editClient`   | 语法   | `public ResultMessage addClient(String ID, String category, int level, String name, String phone, String address, String post, String email, UserVO salesman)` |
|                                | 前置条件 | 修改的客户信息符合输入条件                            |
|                                | 后置条件 | 修改客户信息，更新持久化对象                           |
| `ClientBlService.deleteClient` | 语法   | `public ResultMessage deleteClient(String ID, String name)` |
|                                | 前置条件 | 修改的客户信息符合输入条件                            |
|                                | 后置条件 | 删除客户，更新持久化对象                             |
<br/>

| clinetbl模块需要的服务（需接口）                     |                    |
| ---------------------------------------- | ------------------ |
| 服务名                                      | 服务                 |
| `ClientDataService.findClients(String name,String ID)` | 根据姓名和id进行查找多个持久化对象 |
| `ClientDataService.add(ClientPO po)`     | 添加单一化持久对象          |
| `ClientDataService.delet(ClientPO po)`   | 删除单一化持久对象          |
| `ClientDataService.update(ClientPO po)`  | 更改单一化持久对象          |
| `ClientDataService.getClientData()`      | 得到Client数据的服务引用    |
<br/>

| purchasebl模块提供的服务（供接口）                   |      |                                          |
| ---------------------------------------- | ---- | ---------------------------------------- |
| `PurchaseTradeBillBLService.getID`       | 语法   | `public String getID ()`                 |
|                                          | 前置条件 | 开始创建一个进货单                                |
|                                          | 后置条件 | 得到该进货单的编号                                |
| `PurchaseTradeBillBLService.calculateTotal` | 语法   | `public double calculateTotal(ArrayList<Goods> goosList)` |
|                                          | 前置条件 | 输入商品                                     |
|                                          | 后置条件 | 计算商品的总价                                  |
| `PurchaseTradeBillBLService.submit`      | 语法   | `public ResultMessage submit(PurchaseTradeBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被提交发送给经理进行审批                           |
| `PurchaseTradeBillBLService.saveDraft`   | 语法   | `public ResultMessage saveDraft(PurchaseTradeBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被保存为草稿                                 |
| `PurchaseRefundBillBLService.getID`      | 语法   | `public String getID ()`                 |
|                                          | 前置条件 | 开始创建一个进货退货单                              |
|                                          | 后置条件 | 得到该进货退货单的编号                              |
| `PurchaseRefundBillBLService.calculateTotal` | 语法   | `public double calculateTotal(ArrayList<Goods> goosList)` |
|                                          | 前置条件 | 输入商品                                     |
|                                          | 后置条件 | 计算商品的总价                                  |
| `PurchaseRefundBillBLService.submit`     | 语法   | `public ResultMessage submit(PurchaseRefundBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被提交发送给经理进行审批                           |
| `PurchaseRefundBillBLService.saveDraft`  | 语法   | `public ResultMessage saveDraft(PurchaseRefundBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被保存为草稿                                 |

| purchasebl模块需要的服务（需接口）                   |                 |
| ---------------------------------------- | --------------- |
| 服务名                                      | 服务              |
| `PurchaseTradeBillDataService.find(String id)` | 根据ID进行查找单一持久化对象 |
| `PurchaseTradeBillDataService.insert(PurchasePO po)` | 插入单一持久化对象       |
| `PurchaseTradeBillDataService.delete(PurchasePO po)` | 删除单一持久化对象       |
| `PurchaseTradeBillDataService.update(PurchasePO po)` | 更新单一持久化对象       |
| `PurchaseRefundBillDataService.find(String id)` | 根据ID进行查找单一持久化对象 |
| `PurchaseRefundBillDataService.insert(PurchasePO po)` | 插入单一持久化对象       |
| `PurchaseRefundBillDataService.delete(PurchasePO po)` | 删除单一持久化对象       |
| `PurchaseRefundBillDataService.update(PurchasePO po)` | 更新单一持久化对象       |
<br/>

| salebl模块提供的服务（供接口）                       |      |                                          |
| ---------------------------------------- | ---- | ---------------------------------------- |
| `SaleTradeBillBLService.getID`           | 语法   | `public String getID ()`                 |
|                                          | 前置条件 | 开始创建一个销售单                                |
|                                          | 后置条件 | 得到该销售单的编号                                |
| `SaleTradeBillBLService.calculateTotal`  | 语法   | `public double calculateTotal(ArrayList<GoodsVO> goosList)` |
|                                          | 前置条件 | 输入商品                                     |
|                                          | 后置条件 | 计算商品的总价                                  |
| `SaleTradeBillBLService.findPromotionClient` | 语法   | `public PromotionClientVO findPromotionClient(ClientVO client)  ` |
|                                          | 前置条件 | 已知客户等级信息                                 |
|                                          | 后置条件 | 取得相应的客户等级促销策略信息                          |
| `SaleTradeBillBLService.findPromotionTotal` | 语法   | `public PromotionTotalVO findPromotionTotal(ArrayList<GoodsVO>)  ` |
|                                          | 前置条件 | 已知商品总价                                   |
|                                          | 后置条件 | 取得相应的总价促销策略信息                            |
| `SaleTradeBillBLService.findPromotionGoods` | 语法   | `public PromotionGoodsVO findPromotionGoods(ArrayList<GoodsVO>)  ` |
|                                          | 前置条件 | 已知商品信息                                   |
|                                          | 后置条件 | 取得相应的特价包促销策略信息                           |
| `SaleTradeBillBLService.submit`          | 语法   | `public ResultMessage submit(PurchaseTradeBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被提交发送给经理进行审批                           |
| `SaleTradeBillBLService.saveDraft`       | 语法   | `public ResultMessage saveDraft(PurchaseTradeBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被保存为草稿                                 |
| `SaleRefundBillBLService.getID`          | 语法   | `public String getID ()`                 |
|                                          | 前置条件 | 开始创建一个销售单                                |
|                                          | 后置条件 | 得到该销售单的编号                                |
| `SaleRefundBillBLService.calculateTotal` | 语法   | `public double calculateTotal(ArrayList<GoodsVO> goosList)` |
|                                          | 前置条件 | 输入商品                                     |
|                                          | 后置条件 | 计算商品的总价                                  |
| `SaleRefundBillBLService.submit`         | 语法   | `public ResultMessage submit(PurchaseTradeBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被提交发送给经理进行审批                           |
| `SaleRefundBillBLService.saveDraft`      | 语法   | `public ResultMessage saveDraft(PurchaseTradeBillVO bill)` |
|                                          | 前置条件 | 单据已经被制定出                                 |
|                                          | 后置条件 | 单据被保存为草稿                                 |
<br/>

| salebl模块需要的服务（需接口）                       |                 |
| ---------------------------------------- | --------------- |
| 服务名                                      | 服务              |
| `SaleRefundBillDataService.findPromotionClient(ClientPO client,GoodsPO goods)` | 查找相应的客户等级促销策略信息 |
| `SaleRefundBillDataService.findPromotionTotal(ClientPO client,GoodsPO goods)` | 查找相应的商品总价促销策略信息 |
| `SaleRefundBillDataService.findPromotionGoods(ClientPO client,GoodsPO goods)` | 查找相应的特价包促销策略信息  |
| `PurchaseTradeBillDataService.find(String id)` | 根据ID进行查找单一持久化对象 |
| `PurchaseTradeBillDataService.insert(PurchasePO po)` | 插入单一持久化对象       |
| `PurchaseTradeBillDataService.delete(PurchasePO po)` | 删除单一持久化对象       |
| `PurchaseTradeBillDataService.update(PurchasePO po)` | 更新单一持久化对象       |
| `PurchaseRefundBillDataService.find(String id)` | 根据ID进行查找单一持久化对象 |
| `PurchaseRefundBillDataService.insert(PurchasePO po)` | 插入单一持久化对象       |
| `PurchaseRefundBillDataService.delete(PurchasePO po)` | 删除单一持久化对象       |
| `PurchaseRefundBillDataService.update(PurchasePO po)` | 更新单一持久化对象       |
<br/>
